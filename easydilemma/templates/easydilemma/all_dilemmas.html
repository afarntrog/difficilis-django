<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      
    {% load static %}


        <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143158805-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-143158805-1');
  </script>


    <title>Difficilis</title>
    <link rel="shortcut icon" type="image/png" href="{% static 'easydilemma/images/favicon-16x16.png' %}"/>


    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!--My css sheet-->
    <link rel="stylesheet" href="../../static/easydilemma/css/main.css">
    <!--Font Awesome-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <!--jQuery CDN-->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous">
    </script>

    <!--jQuery UI local link-->
    <script src="../../static/easydilemma/jquery-ui-1.12.1/jquery-ui.min.js"></script>
    <!--Loading overlay Libary-->
    <!-- <script src="./jquery-loading-overlay-2.1.6/src/loadingoverlay.js"></script> -->
    <script src="../../static/easydilemma/js/main2.js" ></script>
    <script src="../../static/easydilemma/js/ajax_dilemmas.js" ></script>
<script>
    $(document).ready(function() {

    // Add toggle abibilty to the reasons table
    // When user clicks the text box a new field will display showing the entire reason un-truncated.
    // MUST bind function to dynamically added content
    $("body").on("click", ".expand-reason",function() {
        $(this).next().toggle();
    });

    }); // END READY function.
    
</script>
</head>


<!--Make it inherit the first page navbar-->

<body>
    <header class="header">
        <!-- Navbar-->
        <nav class="navbar navbar-expand-lg fixed-top shadow navbar-light bg-white">
                <div class="d-flex">
                    <a class="navbar-brand grow" href="{% url 'easydilemma:index' %}"><img src="{% static 'easydilemma/images/Logo.png' %}" id="logo" style="max-height: 30px; max-width: 150px;;"  alt="Difficilis"></a>
                    <!-- If you use the above logo insteas of the one with the text then you have to comment out the logo id in main.css  -->
                    <!--<a href="index.html" class="navbar-brand text-uppercase font-weight-bold"><span>Difficilis</span></a> -->
                    <!-- https://logohub.io/# -->
                </div>
            
            <button type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"  class="navbar-toggler navbar-toggler-right">
                <i class="fa fa-bars"></i>
            </button>

            <div class="collapse navbar-collapse" id="navbarCollapse">
                <!--Left side of NavBar-->
                <ul class="navbar-nav">
                <li class="nav-item" ><a  href="{% url 'easydilemma:index' %}" class="nav-link font-weight-bold">Home</a></li>
                <li class="nav-item "><a  href="{% url 'easydilemma:popular_dilemmas' %}" class="nav-link font-weight-bold">Popular</a></li>
                <li class="nav-item"><a  href="{% url 'easydilemma:all_dilemmas' %}" class="nav-link font-weight-bold">Newest</a></li>
                <li class="nav-item"><a  href="{% url 'easydilemma:all_dilemmas' %}" class="nav-link font-weight-bold">All Dilemmas</a></li>

                </ul>
                <!--Right side of NavBar-->
                <ul class="navbar-nav ml-auto">
                    {% if user.is_authenticated %}
                    <li class="nav-item ml-lg-3 "><a  href="{% url 'easydilemma:dilemma' %}" class="btn btn-primary "><strong>New Dilemma</strong></a></li>
                    <li class="nav-item ml-lg-3 "><a  href="{% url 'users:logout' %}" class="btn btn-outline-primary navbar_btn"><strong>Log Out</strong></a></li>
                    {% else %}
                    <li class="nav-item ml-lg-3 "><a  href="{% url 'easydilemma:dilemma' %}" class="btn btn-primary"><strong>New Dilemma</strong></a></li>
                    <li class="nav-item ml-lg-3 "><a  href="{% url 'users:login' %}" class="btn btn-outline-primary navbar_btn" ><strong>LOG IN</strong></a></li>
                    {% endif %}
                </ul>
            </div>
        </nav>
        <!-- /Navbar -->
        </header>

        <!--The finnished dilemma card will go here-->
        <div id="add-content">                   
                

        </div>



    <!-- <script>
        $(document).ready(function() {
            $(".expand-reason").on("click", function() {
                $(this).next().toggle();
            });
    
        });mx-auto mr-sm-2
    </script> -->

    <!-- Form to search other dilemmas -->
    <form action="{% url 'easydilemma:search' %}" method="GET">{% csrf_token %}
        <div class="container mb-4">
            <div class="card w-75 mx-auto"> 
                <div class="input-group">
                    <!-- <form action="#" method="GET">{% csrf_token %} -->
                        <input class="form-control " name="q" value="{{ request.GET.q }}" type="search" placeholder="Search dilemmas" required>
                        <div class="input-group-append">
                            <button class="btn btn-outline-primary my-2 my-sm-0" type="submit">Search</button>
                        </div>
                    <!-- </form> -->
                </div>
            </div>
        </div>
    </form>

{% for dilemma in all_dilemmas %}
{% if dilemma.should_post %} <!--Only display dilemmas that the field is should_post=True-->
<!--TOGGLE CLASS-->                  
<div class="container mb-5">

        <div class="card w-75 mx-auto">                
            <div class="card-header">
                {% if dilemma.user is None %}
                    <span class="small badge badge-pill badge-primary font-weight-normal float-right mt-2 align-middle">anonymous_45{{ dilemma.id }}</span>
                {% else %}
                    <a href="{% url 'easydilemma:username_public_dilemmas' dilemma.user %}"> <span class="small badge badge-pill badge-primary font-weight-normal float-right mt-2 align-middle">{{ dilemma.user }}</span> </a>
                {% endif %}
                    
                <h5>{{ dilemma.dilemma_part_one.dilemma_part_one }} or {{ dilemma.dilemma_part_two.dilemma_part_two }}</h5>
            </div> 
            <div class="card-body">
                    <div class="row mb-3 ml-2">
                        <span class="badge badge-pill badge-secondary text-truncate">Reasons for: {{ dilemma.dilemma_part_one.dilemma_part_one }}</span>
                    </div>
                {% for reason in dilemma.dilemma_part_one.reason_part_one.all %}
                <div class="row mb-3">
                    <div class="col-md-8">
                        <input type="text" class="form-control font-weight-bold expand-reason text-truncate" value="{{ reason.reason }}" readonly>
                        <div class="p-2 mb-3 rounded text-dark font-weight-bold border text-center bg-light" style="display: none" id="full-reason-div">{{ reason.reason }}</div>
                    </div>
                    <div class="col-md-4">
                            {% if reason.selected_option == "1" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Not Really Important" readonly>
                            {% elif reason.selected_option == "2" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Somewhat Important" readonly>
                            {% elif reason.selected_option == "3" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Important" readonly>
                            {% elif reason.selected_option == "4" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Very Important" readonly>
                            {% elif reason.selected_option == "5" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Extremely Important" readonly>
                            {% endif %}
                    </div>
                </div>
                {% endfor %}

                <hr>
                <div class="row mb-3 ml-2">
                    <span class="badge badge-pill badge-secondary text-truncate">Reasons for: {{ dilemma.dilemma_part_two.dilemma_part_two }}</span>
                </div>
                {% for reason in dilemma.dilemma_part_two.reason_part_two.all %}
                <div class="row mb-3">
                    <div class="col-md-8">
                        <input type="text" class="form-control font-weight-bold expand-reason text-truncate" value="{{ reason.reason }}" readonly>
                        <div class="p-2 mb-3 rounded text-dark font-weight-bold border text-center bg-light" style="display: none" id="full-reason-div">{{ reason.reason }}</div>
                    </div>
                    <div class="col-md-4">
                            {% if reason.selected_option == "1" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Not Really Important" readonly>
                            {% elif reason.selected_option == "2" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Somewhat Important" readonly>
                            {% elif reason.selected_option == "3" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Important" readonly>
                            {% elif reason.selected_option == "4" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Very Important" readonly>
                            {% elif reason.selected_option == "5" %}
                                <input type="text" class="form-control text-center font-weight-bold" value="Extremely Important" readonly>
                            {% endif %}                        
                    </div>
                </div>
                {% endfor %}
            </div>
       
        <div class="card-footer voting ">
            <div class="row"> <!--Maybe try to list both buttons in  a list strcture-->
                <div class="col-10 align-self-center"><h5><strong>Result: {{ dilemma.result }}</strong></h5></div>

                {% if user.is_authenticated %}
                    <div class="col-2">
                        <div class="row">
                            <div class="col-4 text-right btn grow" ><i id="vote_up"    data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-up text-primary"></i></div>
                            <div class="col-4 text-center btn" id="vote_count"><strong>{{ dilemma.vote_score }}</strong> </div>
                            <div class="col-4 text-right btn grow"><i id="vote_down" data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-down text-danger"></i></div>           
                        </div>
                    </div>
                    <!-- <div class="col-md-1 text-right btn grow"><i id="vote_up"  data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-up text-primary"></i></div>
                    <div class="col-md-1 text-right btn grow"><i id="vote_down" data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-down text-danger"></i></div> -->
                {% else %}
                    <div class="col-2">
                        <div class="row hi">
                            <div class="col-4 text-right btn grow" data-toggle="tooltip" data-placement="auto" title="Login to vote"><i id="vote_up"    data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-up text-primary"></i></div>
                            <div class="col-4 text-center btn"><strong id="vote_count" >{{ dilemma.vote_score }}</strong></div>
                            <div class="col-4 text-right btn grow" data-toggle="tooltip" data-placement="auto" title="Login to vote"><i id="vote_down" data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-down text-danger"></i></div>           
                        </div>
                    </div>
                    <!-- <div class="col-md-1 text-right btn grow" data-toggle="tooltip" data-placement="auto" title="Login to vote"><i id="vote_up"    data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-up text-primary"></i></div>
                    <div class="col-md-1 text-right btn grow" data-toggle="tooltip" data-placement="auto" title="Login to vote"><i id="vote_down" data-href="{% url 'easydilemma:handle_vote' dilemma.id %}" class="fas fa-thumbs-down text-danger"></i></div> -->
                {% endif %}

            </div>
        </div>

        </div>
    </div>
</div>

{% endif %}
{% endfor %}
<br> <br>

<!--This will make an ajax request to the vote view-->

<script rel="script" type="text/javascript">
    $(document).ready(function () {
        $('.voting').on('click', '#vote_up', function (e) {
            e.preventDefault();
            $.ajax({
                url: $(this).attr("data-href"), // change it to be a link and this shold be in the link or form,
                data: {'status': 'vote_up'},
                success: function (data) {
                    location.reload();

                }
            })
        });

        $('.voting').on('click', '#vote_down', function (e) {
            e.preventDefault();
            $.ajax({
                url: $(this).attr("data-href"), // change it to be a link and this shold be in the link or form,
                data: {'status': 'vote_down'},
                success: function (data) {
                    location.reload();
                    // alert(data.score);
                }
            })
        });
    })
</script>











{% if all_dilemmas.has_other_pages %}
<div class="container d-flex justify-content-center">
        <!-- <div class="card w-75 mx-auto"> -->
<nav aria-label="Page navigation example">
        <ul class="pagination">
            {% if all_dilemmas.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ all_dilemmas.previous_page_number }}{% if query %}&q={{ query }}{% endif %}">Previous</a></li>
            {% else %}
                <li class="page-item disabled"><a class="page-link" >Previous</a></li>
            {% endif %}

            {% for i in all_dilemmas.paginator.page_range %}
                {% if all_dilemmas.number == i %}
                    <li class="active page-item"><a class="page-link" href="?page={{ i }}">{{ i }}<span class="sr-only">(current)</span></a></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}{% if query %}&q={{ query }}{% endif %}">{{ i }}</a></li>
                {% endif %}
                    
            {% endfor %}
            {% if all_dilemmas.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ all_dilemmas.next_page_number }}{% if query %}&q={{ query }}{% endif %}">Next</a></li>
            {% else %}
            <li class="page-item disabled"><a class="page-link" >Next</a></li>
            {% endif %}
            
        </ul>
      </nav>
        </div>
<!-- </div> -->

      {% endif %}





    <!-- FOOTER -->
    <!-- <hr>
    <footer class="container pt-5">

        <div class="float-right"><a href="#" id="back-to-top"></a></div>

        <p class="float-right"><a href="#"></a></p>
        <p>&copy; 2019 Aaron Farntrog</p>
    </footer> -->

    
  <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>


</body>
</html>